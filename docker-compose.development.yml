services:
  backend:
    environment:
      RAILS_ENV: development

  frontend:
    volumes:
      - ./frontend/src:/app
      - node_modules:/app/node_modules
    build:
      args:
        NODE_ENV: production
    environment:
      NODE_ENV: development

  # 脆弱性診断の ZAP コンテナを compose に置く（**自動スキャンは実行しない**）
  zap:
    image: zaproxy/zap-stable
    # デーモンで待機させて、プロキシとして使いたいときに起動する想定
    command: ["zap.sh", "-daemon", "-host", "0.0.0.0", "-port", "8080", "-config", "api.disablekey=true"]
    # ports:
    #   - "8081:8080"   # ホストからプロキシへアクセスしたい場合に使う（任意）
    volumes:
      - ./_volumes:/zap/wrk    # レポート出力先（compose 管理下のホストフォルダ）
    restart: "no"
    environment:
      ZAP_LANG: ja
      LANG: "ja_JP.UTF-8"
      LANGUAGE: "ja_JP:ja"
      LC_ALL: "ja_JP.UTF-8"
